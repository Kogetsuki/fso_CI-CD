name: Health Check

on:
  push: # At first for testing
    branches:
      - main

jobs:
  health_chek:
    runs-on: ubuntu-latest

    steps:
      - name: Check deployment health
        uses: jtalk/url-health-check-action@v4
        with:
          url: https://fso-ci-cd-0q26.onrender.com/doesnt-exist
          max-attempts: 3
          retry-delay: 5s
          follow-redirect: true
          expected-statuses: 200

      - name: Notify Discord on failure
        if: failure()
        uses: rjstone/discord-webhook-notify@v2.2.1
        with:
          webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}
          username: CI Bot
          avatarUrl: https://i.imgur.com/4M34hi2.png
          severity: error
          title: "Health Check failed"
          description: "The periodic health check failed for <https://fso-ci-cd-0q26.onrender.com/doesnt-exist>"
          footer: "Health Monitor â€¢ ${{ github.run_id }}"
